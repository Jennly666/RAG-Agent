# CryptoMentor OKX — RAG-нейросотрудник по материалам OKX Academy

Проект демонстрирует RAG-пайплайн с:
- осмысленной структурой данных,
- гибридным поиском (векторный поиск + возможность keyword-поиска),
- компрессией контекста,
- контролем токенов,
- базовой безопасностью и борьбой с галлюцинациями,
- удобным веб-интерфейсом (Gradio).

---

- помогает новичкам и продолжающим трейдерам,
- объясняет работу P2P, торговых ботов, покупку с карты, интеграцию с TradingView,
- не придумывает факты и честно говорит «не знаю», если в базе знаний нет ответа.

## Краткий обзор возможностей

- **RAG поверх статей OKX Academy**
  - парсинг материалов ([OKX Academy](https://www.okx.com/ru/learn/tag/beginner-trading-guide)),
  - нормализация, нарезка на смысловые чанки, добавление метаданных (теги, уровни).

- **Умный поиск (retriever)**
  - векторный поиск (Chroma + OpenAIEmbeddings),
  - возможность добавить BM25/keyword-поиск для гибридного retriever,
  - тематические фильтры по тегам (`p2p`, `bots`, `tradingview`, `risk` и т.п.).

- **Компрессия контекста**
  - `ContextualCompressionRetriever` уменьшает объем передаваемого текста,
  - учитывается лимит токенов, чтобы не переполнять контекст модели.

- **Финальная QA-цепочка**
  - кастомный system prompt нейро-сотрудника,
  - структура ответа: коротко → подробно → источники,
  - явная привязка к статьям (title + description).

- **Контроль галлюцинаций**
  - порог по релевантности: если контекст слабый — честный отказ,
  - опциональный self-check: модель проверяет свои же утверждения по контексту,
  - ответы только на основе переданных документов.

- **Безопасность**
  - простая фильтрация запросов (обход KYC, «как обмануть биржу», гарантированная прибыль и т.п.),
  - отказ от прямых инвестиционных рекомендаций.

- **Готовый веб-интерфейс**
  - Gradio-приложение, запускается локально,
  - поле ввода вопроса, аккуратный вывод ответа и списка источников.

---

## Портрет нейро-сотрудника

**Роль:** Виртуальный эксперт по трейдингу и продуктам OKX.

**Характер и стиль общения:**

- говорит простым русским языком;
- сначала даёт краткий ответ, потом подробное объяснение;
- никогда не даёт финансовых советов «купите X — это вырастет»;
- использует только переданные ему материалы OKX;
- если в базе знаний нет ответа — честно признаётся и не придумывает.

**Системный промпт (вырезка):**

> Ты — нейро-сотрудник CryptoMentor OKX.  
> Твоя задача — отвечать на вопросы о торговле криптовалютами и сервисах платформы OKX, используя только предоставленный контекст (материалы OKX Academy).  
> Если информация в контексте недостаточна, честно напиши, что не можешь ответить без домыслов.  
> Не давай инвестиционных рекомендаций и не помогай обходить правила биржи.

Полный текст промптов лежит в `rag/prompts.py`.

---

## Архитектура

Условный пайплайн:

```text
Пользователь
   ↓
Safety Filter (app/safety.py)
   ↓
Retriever (rag/retriever.py)
   • Векторный поиск (Chroma)
   • Тематические фильтры по тегам
   • Компрессия контекста
   • Лимит по токенам
   ↓
QA Chain (rag/qa_chain.py)
   • System prompt CryptoMentor_OKX
   • Ответ: кратко → подробно → источники
   • (опционально) Self-check утверждений
   ↓
Интерфейс Gradio (app/gradio_app.py)
